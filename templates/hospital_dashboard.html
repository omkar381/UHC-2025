<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Dashboard - Universal Health Card</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        /* Dashboard specific styles */
        :root[data-theme="light"] {
            --primary-color: #4e73df;
            --secondary-color: #224abe;
            --accent-color: #1cc88a;
            --background-color: #f8f9fc;
            --card-bg: #ffffff;
            --text-color: #2e384d;
            --border-color: #e3e6f0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-color: rgba(78, 115, 223, 0.1);
        }

        :root[data-theme="dark"] {
            --primary-color: #4e73df;
            --secondary-color: #224abe;
            --accent-color: #1cc88a;
            --background-color: #1a1c23;
            --card-bg: #2a2d35;
            --text-color: #e3e6f0;
            --border-color: #404756;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-color: rgba(78, 115, 223, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 1000;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .navbar-brand {
            color: white !important;
            font-weight: 600;
            font-size: 1.4rem;
            transition: all 0.3s ease;
        }

        .navbar-brand:hover {
            transform: translateY(-2px);
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-link:hover {
            color: white !important;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .dashboard-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px var(--shadow-color);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            animation: fadeIn 0.6s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px var(--shadow-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .record-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 4px var(--shadow-color);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .record-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 6px var(--shadow-color);
            border-color: var(--primary-color);
        }

        .user-photo {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            object-fit: cover;
            border: 3px solid var(--card-bg);
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .btn-verify {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 0.7rem 1.5rem;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-verify:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 123, 229, 0.4);
        }

        .btn-verify::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
        }

        .btn-verify:hover::after {
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }

        .form-control {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 0.7rem 1rem;
            transition: all 0.3s ease;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 123, 229, 0.1);
        }

        .alert {
            border-radius: 12px;
            border: none;
            padding: 1rem;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-10px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .modal-content {
            border-radius: 16px;
            border: none;
            box-shadow: 0 10px 15px var(--shadow-color);
            animation: modalFade 0.3s ease;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 16px 16px 0 0;
            padding: 1.5rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .treatment-history-item, .certificate-history-item {
            background: var(--background-color);
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .treatment-history-item:hover, .certificate-history-item:hover {
            transform: translateX(5px);
            border-color: var(--primary-color);
        }

        .btn-outline-primary {
            border-color: var(--primary-color);
            color: var(--primary-color);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            color: white;
        }

        .btn-outline-danger {
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .btn-outline-danger:hover {
            transform: translateY(-2px);
        }

        /* Loading animation */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 1.5s infinite;
        }

        /* Theme toggle */
        .theme-toggle {
            background: none;
            border: none;
            color: white;
            opacity: 0.9;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: rotate(360deg);
            opacity: 1;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg animate__animated animate__fadeIn">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-hospital-user me-2"></i>
                Hospital Dashboard
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-chart-line me-1"></i>Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-cog me-1"></i>Settings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </a>
                    </li>
                    <li class="nav-item ms-2">
                        <button class="theme-toggle" id="theme-toggle" title="Toggle dark mode">
                            <i class="fas fa-moon"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row">
            <div class="col-lg-4">
                <div class="dashboard-card animate__animated animate__fadeInLeft">
                    <h4 class="mb-4"><i class="fas fa-user-check me-2"></i>Verify Patient</h4>
                    <form id="verificationForm" class="verification-form">
                        <div class="mb-3">
                            <label for="uin" class="form-label">Patient UIN</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                                <input type="text" class="form-control" id="uin" required placeholder="Enter UIN">
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-verify">
                                <i class="fas fa-search me-2"></i>Verify Patient
                            </button>
                        </div>
                    </form>
                    <div class="alert alert-danger mt-3 animate__animated animate__fadeIn" id="verificationError" style="display: none;"></div>
                    <div class="alert alert-success mt-3 animate__animated animate__fadeIn" id="verificationSuccess" style="display: none;"></div>
                </div>

                <!-- Medical Record Form - Initially Hidden -->
                <div class="dashboard-card mt-4 animate__animated animate__fadeInUp" id="medicalRecordForm" style="display: none;">
                    <h4 class="mb-4"><i class="fas fa-file-medical me-2"></i>Add Medical Record</h4>
                    <form id="addRecordForm">
                        <input type="hidden" id="record_uin" name="uin">
                        <input type="hidden" name="hospital_id" value="{{ hospital.id }}">
                        
                        <div class="mb-3">
                            <label for="doctor_name" class="form-label">Doctor Name</label>
                            <input type="text" class="form-control" id="doctor_name" name="doctor_name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="diagnosis" class="form-label">Diagnosis</label>
                            <input type="text" class="form-control" id="diagnosis" name="diagnosis" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="treatment" class="form-label">Treatment</label>
                            <textarea class="form-control" id="treatment" name="treatment" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="medicines" class="form-label">Prescribed Medicines</label>
                            <textarea class="form-control" id="medicines" name="medicines" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                        </div>
                        
                        <hr>
                        <h6>Insurance Information</h6>
                        
                        <div class="mb-3">
                            <label for="inline_insurance_provider" class="form-label">Insurance Provider</label>
                            <input type="text" class="form-control" id="inline_insurance_provider" name="insurance_provider">
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="inline_policy_number" class="form-label">Policy Number</label>
                                <input type="text" class="form-control" id="inline_policy_number" name="policy_number">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="inline_coverage_type" class="form-label">Coverage Type</label>
                                <input type="text" class="form-control" id="inline_coverage_type" name="coverage_type">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="inline_insurance_valid_until" class="form-label">Valid Until</label>
                                <input type="date" class="form-control" id="inline_insurance_valid_until" name="insurance_valid_until">
                            </div>
                        </div>
                        
                        <hr>
                        <h6>Follow-up Appointment</h6>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="inline_follow_up_date" class="form-label">Follow-up Date</label>
                                <input type="date" class="form-control" id="inline_follow_up_date" name="follow_up_date">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="inline_follow_up_time" class="form-label">Follow-up Time</label>
                                <input type="time" class="form-control" id="inline_follow_up_time" name="follow_up_time">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="inline_follow_up_purpose" class="form-label">Purpose</label>
                                <input type="text" class="form-control" id="inline_follow_up_purpose" name="follow_up_purpose" placeholder="e.g., Check-up">
                            </div>
                        </div>
                        
                        <hr>
                        <h6>Treatment History</h6>
                        <p class="text-muted small">Add previous treatments not yet recorded in the system</p>
                        
                        <div id="inlineTreatmentHistoryContainer">
                            <div class="treatment-history-item mb-3 p-3 border rounded">
                                <div class="row">
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" name="treatment_date_0">
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <label class="form-label">Title/Diagnosis</label>
                                        <input type="text" class="form-control" name="treatment_title_0" placeholder="e.g., Influenza">
                                    </div>
                                    <div class="col-md-5 mb-2">
                                        <label class="form-label">Description</label>
                                        <input type="text" class="form-control" name="treatment_description_0" placeholder="e.g., Prescribed antibiotics">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="inlineAddTreatmentBtn">
                                <i class="fas fa-plus me-1"></i>Add Another Treatment
                            </button>
                        </div>
                        
                        <hr>
                        <h6>Previous Certificates</h6>
                        <p class="text-muted small">Add information about previously issued certificates</p>
                        
                        <div id="inlineCertificateHistoryContainer">
                            <div class="certificate-history-item mb-3 p-3 border rounded">
                                <div class="row">
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" name="certificate_date_0">
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Type</label>
                                        <input type="text" class="form-control" name="certificate_type_0" placeholder="e.g., Medical Certificate">
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Doctor</label>
                                        <input type="text" class="form-control" name="certificate_doctor_0" placeholder="e.g., Dr. Smith">
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Purpose</label>
                                        <input type="text" class="form-control" name="certificate_purpose_0" placeholder="e.g., Sick Leave">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="inlineAddCertificateBtn">
                                <i class="fas fa-plus me-1"></i>Add Another Certificate
                            </button>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-verify">
                                <i class="fas fa-save me-2"></i>Save Medical Record
                            </button>
                        </div>
                    </form>
                    <div class="alert alert-danger mt-3" id="recordError" style="display: none;"></div>
                    <div class="alert alert-success mt-3" id="recordSuccess" style="display: none;"></div>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="dashboard-card animate__animated animate__fadeInRight">
                    <h4 class="mb-4"><i class="fas fa-history me-2"></i>Recent Medical Records</h4>
                    {% if records %}
                        {% for record in records %}
                            <div class="record-card p-3 animate__animated animate__fadeIn">
                                <div class="d-flex align-items-center mb-2">
                                    {% if record.user_photo %}
                                        <img src="{{ url_for('static', filename=record.user_photo) }}" alt="User Photo" class="user-photo me-3">
                                    {% else %}
                                        <div class="user-photo me-3 bg-secondary d-flex align-items-center justify-content-center">
                                            <i class="fas fa-user text-white"></i>
                                        </div>
                                    {% endif %}
                                    <div>
                                        <h5 class="mb-0">{{ record.user_name }}</h5>
                                        <small class="text-muted"><i class="fas fa-fingerprint me-1"></i>UIN: {{ record.user_uin }}</small>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <strong><i class="fas fa-calendar me-1"></i>Date:</strong> {{ record.date }}
                                </div>
                                <div class="mb-2">
                                    <strong><i class="fas fa-user-md me-1"></i>Doctor:</strong> {{ record.doctor_name }}
                                </div>
                                <div class="mb-2">
                                    <strong><i class="fas fa-stethoscope me-1"></i>Diagnosis:</strong> {{ record.diagnosis }}
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-outline-primary btn-sm me-2" onclick="viewFullRecord('{{ record|tojson|safe }}')">
                                        <i class="fas fa-eye me-1"></i>View Full Record
                                    </button>
                                    <a href="{{ url_for('view_certificate', record_id=record.record_id) }}" class="btn btn-outline-success btn-sm" target="_blank">
                                        <i class="fas fa-file-medical me-1"></i>View Certificate
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center text-muted animate__animated animate__fadeIn">
                            <i class="fas fa-folder-open fa-3x mb-3"></i>
                            <p>No medical records found</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Record Details Modal -->
    <div class="modal fade" id="recordModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content animate__animated animate__fadeInUp">
                <div class="modal-header">
                    <h5 class="modal-title">Medical Record Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="recordDetails">
                    <!-- Record details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Medical Record Modal -->
    <div class="modal fade" id="addMedicalRecordModal" tabindex="-1" aria-labelledby="addMedicalRecordModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMedicalRecordModalLabel">Add Medical Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addMedicalRecordForm">
                        <input type="hidden" id="hospital_id" name="hospital_id" value="{{ hospital.id }}">
                        
                        <div class="mb-3">
                            <label for="uin" class="form-label">Patient UIN</label>
                            <input type="text" class="form-control" id="uin" name="uin" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="doctor_name" class="form-label">Doctor Name</label>
                            <input type="text" class="form-control" id="doctor_name" name="doctor_name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="diagnosis" class="form-label">Diagnosis</label>
                            <input type="text" class="form-control" id="diagnosis" name="diagnosis" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="treatment" class="form-label">Treatment</label>
                            <textarea class="form-control" id="treatment" name="treatment" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="medicines" class="form-label">Medicines</label>
                            <textarea class="form-control" id="medicines" name="medicines" rows="3" placeholder="Enter each medicine on a new line"></textarea>
                        </div>
                        
                        <div id="medicationDetails" class="mb-3 p-3 border rounded bg-light">
                            <h6>Medication Details</h6>
                            <p class="text-muted small">Add details for each medicine (optional). These will be added after you enter medicines above.</p>
                            <div id="medicationDetailsContent">
                                <!-- Medication details will be added here dynamically -->
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="notes" name="notes" rows="2"></textarea>
                        </div>
                        
                        <hr>
                        <h6>Insurance Information</h6>
                        
                        <div class="mb-3">
                            <label for="insurance_provider" class="form-label">Insurance Provider</label>
                            <input type="text" class="form-control" id="insurance_provider" name="insurance_provider">
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="policy_number" class="form-label">Policy Number</label>
                                <input type="text" class="form-control" id="policy_number" name="policy_number">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="coverage_type" class="form-label">Coverage Type</label>
                                <input type="text" class="form-control" id="coverage_type" name="coverage_type">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="insurance_valid_until" class="form-label">Valid Until</label>
                                <input type="date" class="form-control" id="insurance_valid_until" name="insurance_valid_until">
                            </div>
                        </div>
                        
                        <hr>
                        <h6>Follow-up Appointment</h6>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="follow_up_date" class="form-label">Follow-up Date</label>
                                <input type="date" class="form-control" id="follow_up_date" name="follow_up_date">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="follow_up_time" class="form-label">Follow-up Time</label>
                                <input type="time" class="form-control" id="follow_up_time" name="follow_up_time">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="follow_up_purpose" class="form-label">Purpose</label>
                                <input type="text" class="form-control" id="follow_up_purpose" name="follow_up_purpose" placeholder="e.g., Check-up">
                            </div>
                        </div>
                        
                        <hr>
                        <h6>Treatment History</h6>
                        <p class="text-muted small">Add previous treatments not yet recorded in the system</p>
                        
                        <div id="treatmentHistoryContainer">
                            <div class="treatment-history-item mb-3 p-3 border rounded">
                                <div class="row">
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" name="treatment_date_0">
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <label class="form-label">Title/Diagnosis</label>
                                        <input type="text" class="form-control" name="treatment_title_0" placeholder="e.g., Influenza">
                                    </div>
                                    <div class="col-md-5 mb-2">
                                        <label class="form-label">Description</label>
                                        <input type="text" class="form-control" name="treatment_description_0" placeholder="e.g., Prescribed antibiotics">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="addTreatmentBtn">
                                <i class="fas fa-plus me-1"></i>Add Another Treatment
                            </button>
                        </div>
                        
                        <hr>
                        <h6>Previous Certificates</h6>
                        <p class="text-muted small">Add information about previously issued certificates</p>
                        
                        <div id="certificateHistoryContainer">
                            <div class="certificate-history-item mb-3 p-3 border rounded">
                                <div class="row">
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" name="certificate_date_0">
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Type</label>
                                        <input type="text" class="form-control" name="certificate_type_0" placeholder="e.g., Medical Certificate">
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Doctor</label>
                                        <input type="text" class="form-control" name="certificate_doctor_0" placeholder="e.g., Dr. Smith">
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <label class="form-label">Purpose</label>
                                        <input type="text" class="form-control" name="certificate_purpose_0" placeholder="e.g., Sick Leave">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <button type="button" class="btn btn-outline-primary btn-sm" id="addCertificateBtn">
                                <i class="fas fa-plus me-1"></i>Add Another Certificate
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="submitMedicalRecord">Save Record</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;
            const icon = themeToggle.querySelector('i');
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme') || 'light';
            html.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme === 'dark');

            themeToggle.addEventListener('click', function() {
                // Add transition class to body for smooth color changes
                document.body.classList.add('transitioning');
                
                const isDark = html.getAttribute('data-theme') === 'dark';
                const newTheme = isDark ? 'light' : 'dark';
                
                // Animate the toggle button
                this.classList.add('animate__animated', 'animate__pulse');
                
                // Change the theme with a slight delay for better animation effect
                setTimeout(() => {
                    html.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    updateThemeIcon(!isDark);
                    
                    // Remove animation classes after they complete
                    setTimeout(() => {
                        this.classList.remove('animate__animated', 'animate__pulse');
                        document.body.classList.remove('transitioning');
                    }, 500);
                }, 100);
            });

            function updateThemeIcon(isDark) {
                if (isDark) {
                    icon.className = 'fas fa-sun';
                    themeToggle.setAttribute('title', 'Switch to light mode');
                } else {
                    icon.className = 'fas fa-moon';
                    themeToggle.setAttribute('title', 'Switch to dark mode');
                }
            }
            
            // Add animation to card elements
            document.querySelectorAll('.dashboard-card').forEach((card, index) => {
                card.style.animationDelay = `${0.1 + (index * 0.1)}s`;
            });
            
            document.querySelectorAll('.record-card').forEach((card, index) => {
                card.classList.add('animate__animated', 'animate__fadeInUp');
                card.style.animationDelay = `${0.2 + (index * 0.1)}s`;
            });
        });
        
        // Function to add loading state to buttons
        function setLoading(button, isLoading) {
            if (isLoading) {
                button.addClass('loading');
                button.prop('disabled', true);
                const originalText = button.html();
                button.attr('data-original-text', originalText);
                button.html('<i class="fas fa-spinner fa-spin me-2"></i>Processing...');
            } else {
                button.removeClass('loading');
                button.prop('disabled', false);
                button.html(button.attr('data-original-text'));
            }
        }

        // Smooth scroll to elements
        function scrollToElement(element) {
            $('html, body').animate({
                scrollTop: $(element).offset().top - 100
            }, 500);
        }

        // Enhanced form submission with animations
        document.getElementById('verificationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = $(this).find('button[type="submit"]');
            setLoading(submitButton, true);
            
            const uin = document.getElementById('uin').value;
            const errorAlert = document.getElementById('verificationError');
            const successAlert = document.getElementById('verificationSuccess');
            const medicalRecordForm = document.getElementById('medicalRecordForm');
            
            try {
                const response = await fetch('/verify_uin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ uin: uin })
                });
                
                const data = await response.json();
                
                // Hide alerts with animation
                $(errorAlert).removeClass('animate__fadeIn').addClass('animate__fadeOut');
                $(successAlert).removeClass('animate__fadeIn').addClass('animate__fadeOut');
                $(medicalRecordForm).removeClass('animate__fadeInUp').addClass('animate__fadeOut');
                
                setTimeout(() => {
                    errorAlert.style.display = 'none';
                    successAlert.style.display = 'none';
                    medicalRecordForm.style.display = 'none';
                    
                    if (data.verified) {
                        successAlert.textContent = `Verified: ${data.user_name} (${data.uin})`;
                        $(successAlert).removeClass('animate__fadeOut').addClass('animate__fadeIn').show();
                        
                        // Show medical record form with animation
                        document.getElementById('record_uin').value = uin;
                        $(medicalRecordForm).removeClass('animate__fadeOut').addClass('animate__fadeInUp').show();
                        
                        // Scroll to medical record form
                        scrollToElement(medicalRecordForm);
                    } else {
                        errorAlert.textContent = data.message || 'Invalid UIN';
                        $(errorAlert).removeClass('animate__fadeOut').addClass('animate__fadeIn').show();
                    }
                }, 300);
            } catch (error) {
                errorAlert.textContent = 'An error occurred. Please try again.';
                $(errorAlert).removeClass('animate__fadeOut').addClass('animate__fadeIn').show();
            } finally {
                setLoading(submitButton, false);
            }
        });

        // Enhanced medical record form submission
        document.getElementById('addRecordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = $(this).find('button[type="submit"]');
            setLoading(submitButton, true);
            
            const recordError = document.getElementById('recordError');
            const recordSuccess = document.getElementById('recordSuccess');
            
            try {
                const formData = new FormData(this);
                
                const response = await fetch('/add_medical_record', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                // Hide alerts with animation
                $(recordError).removeClass('animate__fadeIn').addClass('animate__fadeOut');
                $(recordSuccess).removeClass('animate__fadeIn').addClass('animate__fadeOut');
                
                setTimeout(() => {
                    recordError.style.display = 'none';
                    recordSuccess.style.display = 'none';
                    
                    if (data.success) {
                        recordSuccess.textContent = data.message || 'Medical record added successfully';
                        $(recordSuccess).removeClass('animate__fadeOut').addClass('animate__fadeIn').show();
                        this.reset();
                        
                        // Keep the UIN field
                        document.getElementById('record_uin').value = document.getElementById('uin').value;
                        
                        // Refresh the page after animation
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        recordError.textContent = data.message || 'Failed to add medical record';
                        $(recordError).removeClass('animate__fadeOut').addClass('animate__fadeIn').show();
                    }
                }, 300);
            } catch (error) {
                recordError.textContent = 'An error occurred. Please try again.';
                $(recordError).removeClass('animate__fadeOut').addClass('animate__fadeIn').show();
            } finally {
                setLoading(submitButton, false);
            }
        });

        // Enhanced record viewing
        function viewFullRecord(recordJson) {
            const record = JSON.parse(recordJson);
            const modalBody = document.getElementById('recordDetails');
            
            modalBody.innerHTML = `
                <div class="d-flex align-items-center mb-4 animate__animated animate__fadeIn">
                    ${record.user_photo ? 
                        `<img src="/static/${record.user_photo}" alt="User Photo" class="user-photo me-3">` :
                        `<div class="user-photo me-3 bg-secondary d-flex align-items-center justify-content-center">
                            <i class="fas fa-user text-white"></i>
                        </div>`
                    }
                    <div>
                        <h5 class="mb-0">${record.user_name}</h5>
                        <small class="text-muted"><i class="fas fa-fingerprint me-1"></i>UIN: ${record.user_uin}</small><br>
                        <small class="text-muted"><i class="fas fa-birthday-cake me-1"></i>DOB: ${record.user_dob}</small>
                    </div>
                </div>
                <div class="mb-3 animate__animated animate__fadeIn" style="animation-delay: 0.1s">
                    <strong><i class="fas fa-calendar me-1"></i>Date:</strong> ${record.date}
                </div>
                <div class="mb-3 animate__animated animate__fadeIn" style="animation-delay: 0.2s">
                    <strong><i class="fas fa-user-md me-1"></i>Doctor:</strong> ${record.doctor_name}
                </div>
                <div class="mb-3 animate__animated animate__fadeIn" style="animation-delay: 0.3s">
                    <strong><i class="fas fa-stethoscope me-1"></i>Diagnosis:</strong> ${record.diagnosis}
                </div>
                <div class="mb-3 animate__animated animate__fadeIn" style="animation-delay: 0.4s">
                    <strong><i class="fas fa-pills me-1"></i>Treatment:</strong> ${record.treatment}
                </div>
                <div class="mb-3 animate__animated animate__fadeIn" style="animation-delay: 0.5s">
                    <strong><i class="fas fa-prescription me-1"></i>Prescribed Medicines:</strong> ${record.prescribed_medicines}
                </div>
                <div class="mb-3 animate__animated animate__fadeIn" style="animation-delay: 0.6s">
                    <strong><i class="fas fa-notes-medical me-1"></i>Additional Notes:</strong> ${record.additional_notes || 'None'}
                </div>
                <div class="mt-4 text-center animate__animated animate__fadeIn" style="animation-delay: 0.7s">
                    <a href="/view_certificate/${record.record_id}" class="btn btn-primary" target="_blank">
                        <i class="fas fa-file-medical me-2"></i>View Certificate
                    </a>
                </div>
            `;
            
            new bootstrap.Modal(document.getElementById('recordModal')).show();
        }

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });

        // Add hover animation to cards
        document.querySelectorAll('.record-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
                this.style.boxShadow = 'var(--shadow-lg)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = 'var(--shadow-sm)';
            });
        });
    </script>
</body>
</html> 